---
title: '6306 DDS: Case Study 1'
author: "Jaclyn Ann Coate & Huy Hoang Nguyen"
date: "10/7/2019"
output: html_document
---

#Introduction
# a.	The introduction needs to be written as if you are presenting the work to the CEO and CFO of Budweiser (your client) and that they only have had one class in statistics.  If it sounds like a student presentation, that is not acceptable.  You may assume that the CEO and CFO gave you the data and gave you the directive to report any interesting finding that you may uncover through your analysis.

## **I have done some research and would like to take the tactic of presenting the growth of microbreweries and sales in states starting to threaten Budweiser's market share. So we are going to do an analysis on the data we have to recommend the new beers to start selling in those areas to compete with the booming microbrewery business in the United States. ** ##

# b.	Briefly explain the purpose of the code. The explanations should appear as a sentence or two before or after the code chunk. Even though you will not be hiding the code chunks (so that I can see the code), you need to assume that the client can’t see them.

# c.	Use R to code answers concerning the seven questions below.

# Below we are prepping our environment with different libraries we will need to complete our analysis. 
```{r}
library(tidyverse)
library(ggthemes)
library(dplyr)
install.packages("highcharter")
library(highcharter)
install.packages("ggmap")
library(ggmap)
install.packages("ggExtra")
library(ggExtra)
install.packages("treemapify")
library(treemapify)
```


# 1. How many breweries are present in each state?

## Import data Breweries into R.
```{r}
breweries <- read.csv("https://raw.githubusercontent.com/BivinSadler/MDS-6306-Doing-Data-Science-Fall-2019/master/Unit%208%20and%209%20Case%20Study%201/Breweries.csv", header = TRUE)
breweries
nrow(breweries)
summary(breweries)
```

## Breweries bar graphed by state.
```{r}
breweries %>% ggplot(mapping = aes(x=State, fill=State)) +
  geom_bar(sstat = "identity") +
  #theme_excel_new() +
  theme_tufte() +
  theme(legend.position="none") + 
ggtitle("Breweries by State") + ylab("Count") + xlab("State")
```

## ** Breweries geo graphed by state
## ** Create a Geo map of shaded color for the states with the largest count of breweries ** #

##DONE DONE DONE DONE DONE DONE DONE DONE##
# 2. Merge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  (RMD only, this does not need to be included in the presentation or the deck.)

## Import Beer data into R
```{r}
beers <- read.csv("https://raw.githubusercontent.com/BivinSadler/MDS-6306-Doing-Data-Science-Fall-2019/master/Unit%208%20and%209%20Case%20Study%201/Beers.csv", header = TRUE)
str(beers)
view(beers)
```

## We obvserve that our key value "Brew_ID" from our breweries data is named "Brewery_id". In order to have these values match and make tables easier to merge we are renaming the column in the beer data set.
```{r}
beers <-  beers %>% dplyr::rename( Brew_ID = Brewery_id)
beers
```

## We observe that the two name columns have the same name in our Brewery and Beer data sets. So we are giving them unique identifiers.
```{r}
breweries <- breweries %>% dplyr::rename(Name_Brew = Name)  
beers <- beers %>% dplyr::rename(Name_Beer = Name)

breweries
beers
```


## We complete a full_join of both data frames to loose minimum amount of data for review.
```{r}
brew.beer <- full_join(breweries, beers, by = "Brew_ID")
str(brew.beer)
brew.beer
```

## We print first 6 and last 6 rows of merged data set below.
```{r}
brew.beer %>% tail(6)
brew.beer %>% head(6)
```




##DONE DONE DONE DONE DONE DONE DONE DONE##
# 3. Address the missing values in each column.

## We review the data nd we see ABV contains 62 NAs and IBU contains 1005 NAs. We are keeping those data frames separate to prevent more data loss.

```{r}
brew.beer %>% summarise_all(funs(sum(is.na(.))))
```





# 4. Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.

## Per discussion above we choose to keep the data frames separate to reduce the amount of data lost to NAs

## Graphing Median ABV by State
### Huy's Code
```{r}
brew.beer.cleanABV <- brew.beer %>% filter(!is.na(ABV))
MedianABV <- brew.beer.cleanABV %>% group_by(State) %>% summarise(medABV = median(c(ABV)))

MedianABV %>% ggplot(aes(fill=State, y=medABV, x=State)) + 
  geom_bar(stat="identity") + 
  theme_excel_new() +
ggtitle("Median ABV by State") + ylab("ABV") + xlab("State")
```

### Jaclyn's Code
```{r}
brew.beer.cleanABV <- brew.beer %>% filter(!is.na(ABV))

# Group median ABV by State
brew.beerABV <- aggregate(brew.beer.cleanABV$ABV, by=list(brew.beer.cleanABV$State), FUN = median)
brew.beerABV
# Label Columns
colnames(brew.beerABV) <- c("State", "MedABV")
brew.beerABV
# Sort
brew.beerABV <- brew.beerABV[order(brew.beerABV$MedABV),]
# Retain order in the Plot
brew.beerABV$State <- factor(brew.beerABV$State, levels = brew.beerABV$State)
```

```{r}
brew.beerABV %>% ggplot(mapping = aes(x=State, y=MedABV)) +
  geom_bar(stat = "identity") +
  geom_col(aes(fill = MedABV)) + 
  scale_fill_gradient(low = "pink", high = "dark red") +
  theme_excel_new() +
  theme(legend.position="none", axis.text.x = element_text(angle=65, vjust=0.6)) +
  ggtitle("Median ABV by State") + ylab("Median ABV") + xlab("State")
```


## Graphing Median IBU by State

### Huy's Code
```{r}
brew.beer.cleanIBU <- brew.beer %>% filter(!is.na(IBU))
MedianIBU <- brew.beer.cleanIBU %>% group_by(State) %>% summarise(medIBU = median(c(IBU)))

MedianIBU %>% ggplot(aes(fill=State, y=medIBU, x=State)) + 
  geom_bar(stat="identity") + 
  theme_excel_new() +
ggtitle("Median IBU by State") + ylab("IBU") + xlab("State")
```

### Jaclyn's Code
```{r}
brew.beer.cleanIBU <- brew.beer %>% filter(!is.na(IBU))
MedianIBU <- brew.beer.cleanIBU %>% group_by(State) %>% summarise(medIBU = median(c(IBU)))

MedianIBU %>% ggplot(aes(fill=State, y=medIBU, x=State)) + 
  geom_bar(stat="identity") + 
  theme_excel_new() +
  theme(legend.position="none") +
ggtitle("Median IBU by State") + ylab("IBU") + xlab("State")
```

```{r}
brew.beer.cleanIBU <- brew.beer %>% filter(!is.na(IBU))

# Group median ABV by State
brew.beerIBU <- aggregate(brew.beer.cleanIBU$IBU, by=list(brew.beer.cleanIBU$State), FUN = median)
brew.beerIBU
# Label Columns
colnames(brew.beerIBU) <- c("State", "MedIBU")
brew.beerIBU
# Sort
brew.beerIBU <- brew.beerIBU[order(brew.beerIBU$MedIBU),]
# Retain order in the Plot
brew.beerIBU$State <- factor(brew.beerIBU$State, levels = brew.beerIBU$State)
```


##DONE DONE DONE DONE DONE DONE DONE DONE##
# 5a. Which state has the maximum alcoholic (ABV) beer? 

## Below we have listed the higest median ABV.
```{r}
y_maxABV <- max(MedianABV[,2])
y_maxABV
stateABV_associated <- MedianABV[MedianABV$medABV == y_maxABV, "State"]
stateABV_associated
```
### The State with the highest median ABV is DC and KY at 6.45%.

## Jaclyn's code on this question
## Below we have listed the max ABV.
```{r}
brew.beer
brew.beer[which.max(brew.beer$ABV),]
```
### The state with the highest ABV is Colorado at 12.8%.

# 5b. Which state has the most bitter (IBU) beer?

## Below we have listed the higest median ABV.
```{r}
y_maxIBU <- max(MedianIBU[,2])
y_maxIBU
stateIBU_associated <- MedianIBU[MedianIBU$medIBU == y_maxIBU, "State"]
stateIBU_associated
```
### The state with the highest median IBU is Main at 61.

## Jaclyn's code on this question
## Below we have listed the max IBU.
```{r}
brew.beer
brew.beer[which.max(brew.beer$IBU),]
```
### The sate with the highest IBU is Oregon at 138.





##DONE DONE DONE DONE DONE DONE DONE##
# 6. Comment on the summary statistics and distribution of the ABV variable.

## Show boxplot of summary statistics to review more visually (refine graph below)
### From the summary statistics we can see the median ABV has a pretty small distribution. The majority of the beers that are produced fall between 5.5% - 5.8%. This is slightly higher than the mass produced Budweiser products of 4.2%. Whenever local consumers are given an option they are likely to choose a microbrew that contains a slightly higher ABV than your traditional products. For this reason we will actually be recommending new Budweiser releases by region and of a different ABV than what Budweiser is used to.
```{r}
summary(MedianABV)
MedianABV %>% ggplot(mapping = aes(y = medABV)) +
  geom_boxplot(fill = "dark red", color = "black") +
  theme_excel_new() +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) +
  ggtitle("Median ABV Summary Statistics") + ylab("Median ABV") + xlab("")
```



# 7a. Is there an apparent relationship between the bitterness of the beer and its alcoholic content? 
## There does seem to be a relationsihp between IBU and ABV. We will further investigate with the below.

# 7b. Draw a scatter plot.
```{r}
brew.beer
brew.beer %>% ggplot(mapping = aes(x=IBU, y=ABV)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  theme_excel_new() +
ggtitle("Bitterness (IBU) vs. Alcoholic Content (IBV)") + ylab("IBU") + xlab("ABV")
```

### 7b. Scatter plot with densigram
```{r}
brew.beer
ggMarginal(brew.beer %>% ggplot(mapping = aes(x=IBU, y=ABV)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  theme_excel_new() +
ggtitle("Bitterness (IBU) vs. Alcoholic Content (IBV)") + ylab("IBU") + xlab("ABV"), type = "densigram", fill = "blue")
```

### 7b. Scatter plot with violin
```{r}
brew.beer
ggMarginal(brew.beer %>% ggplot(mapping = aes(x=IBU, y=ABV)) +
  geom_point() + 
  geom_smooth(method = 'lm') +
  theme_excel_new() +
ggtitle("Bitterness (IBU) vs. Alcoholic Content (IBV)") + ylab("IBU") + xlab("ABV"), type = "violin", fill = "blue")
```

# By State
## NEED TO FIGURE OUT WHY LEGEND IS STILL SHOWING
```{r}
brew.beer
brew.beer %>% ggplot(mapping = aes(x=IBU, y=ABV, color=State)) +
  geom_point() + 
  theme(legend.position="none") +
  theme_excel_new() +
ggtitle("Bitterness (IBU) vs. Alcoholic Content (IBV)") + ylab("IBU") + xlab("ABV")
```

## ** Create a scatter plot of a third variable against the IBU and ABV (e.g. Style of Beer, State) fill with that metric

# 7c. Make your best judgment of a relationship and EXPLAIN your answer.
## Based on the above scatter plot and correlation line we can see a small positive linear relationship. This tells us that as the alcohol content (ABV), in general, so does the bitterness (IBU). This linear correlation means there is a relationship but does not mean that we can provide causation. Therefore, while, these two things do have a positive linear relationship, we cannot clearly state that one high value causes the high value of another.




# 8. Budweiser would also like to investigate the difference with respect to IBU and ABV between IPAs (India Pale Ales) and other types of Ale (any beer with “Ale” in its name other than IPA).  You decide to use KNN clustering to investigate this relationship.  Provide statistical evidence one way or the other. You can of course assume your audience is comfortable with percentages … KNN is very easy to understand.  

## ADDED: The text of case study question 8 has been edited slightly (the deliverables are still the same) in an updated version of the document on github  (from knn - clustering to classification): the goal is to classify between IPA and just Ale using IBU and ABV attributes.
```{r}
```

```{r}
```

```{r}
```

```{r}
```


# 9. Knock their socks off!  Find one other useful inference from the data that you feel Budweiser may be able to find value in.  You must convince them why it is important and back up your conviction with appropriate statistical evidence. 

# ** We use the same analysis above but by Beer Type, this will allow us to advise Budweiser on the Beer Type, IBU, ABV BY STATE of a new beer to release to compete with the growing market in all of their regions. We could also split this into regions instead of all the way down into state. A large company like Bud wouldn't do things on the state level but the Regional level. ** #

```{r}
```

```{r}
```

```{r}
```

```{r}
```
