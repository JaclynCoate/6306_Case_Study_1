---
title: "8. KNN"
author: "Jaclyn Ann Coate"
date: "10/22/2019"
output: html_document
---

```{r}
library(class)
library(caret)
library(tidyverse)
```

```{r Create a working data set for this problem}
breweries <- read.csv("https://raw.githubusercontent.com/BivinSadler/MDS-6306-Doing-Data-Science-Fall-2019/master/Unit%208%20and%209%20Case%20Study%201/Breweries.csv", header = TRUE, strip.white=TRUE)

beers <- read.csv("https://raw.githubusercontent.com/BivinSadler/MDS-6306-Doing-Data-Science-Fall-2019/master/Unit%208%20and%209%20Case%20Study%201/Beers.csv", header = TRUE)

beers <-  beers %>% dplyr::rename( Brew_ID = Brewery_id)

breweries <- breweries %>% dplyr::rename(Name_Brew = Name)  
beers <- beers %>% dplyr::rename(Name_Beer = Name)

brew.beer <- full_join(breweries, beers, by = "Brew_ID")
str(brew.beer)
glimpse(brew.beer)
```

```{r Create new data frame without NA values on ABV and IBU}
brew.beer.cleanABVIBU <- brew.beer %>% filter(!is.na(ABV) &!is.na(IBU))
view(brew.beer.cleanABVIBU)
```

```{r Create 2 dataframes  - IPA and Ales and regroup them.}
Ales.beer <- cbind(brew.beer.cleanABVIBU, type='Ales', stringsAsFactors=F) %>% filter(grepl('\\bale\\b', Style, ignore.case=T) | grepl('\\bale\\b', Name_Beer, ignore.case=T))

IPA.beer <- cbind(brew.beer.cleanABVIBU, type='IPA', stringsAsFactors=F) %>% filter(grepl('\\bIPA\\b', Style, ignore.case=T) | grepl('\\bIPA\\b', Name_Beer, ignore.case=T))

IPA.Ales <- union(Ales.beer, IPA.beer)

IPA.Ales$type <- as.factor(IPA.Ales$type)
```

```{r KNN model}
set.seed(100)
splitPerc = .7
iterations = 500
numks =100 
masterAcc = matrix(nrow = iterations, ncol = numks)
for(j in 1:iterations) {
  accs = data.frame(accuracy = numeric(numks), k = numeric(numks))
  trainIndices = sample(1:dim(IPA.Ales)[1],round(splitPerc * dim(IPA.Ales)[1]))
  train = IPA.Ales[trainIndices,]
  test = IPA.Ales[-trainIndices,]
  for(i in 1:numks) {
    classifications = knn(train[,c('IBU','ABV')],test[,c('IBU','ABV')],as.factor(train$type), prob = TRUE, k = i)
    table(as.factor(test$type),classifications)
    CM = confusionMatrix(table(as.factor(test$type),classifications))
    masterAcc[j,i] = CM$overall[1]
  }
}
MeanAcc = colMeans(masterAcc)
plot(seq(1,numks,1),MeanAcc, type = "l")
k <- which.max(MeanAcc)
```

```{r The best value of k is 6 for %Acurracy}
classifications = knn(train[,c('IBU','ABV')],test[,c('IBU','ABV')],train$type, prob = TRUE, k)
table(test$type,classifications)
confusionMatrix(table(test$type,classifications))
```




